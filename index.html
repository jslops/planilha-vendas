<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Ponto Digital - Sistema Gratuito</title>
    <meta name="description" content="Sistema gratuito de controle de ponto eletr√¥nico. Registre suas horas trabalhadas, calcule sal√°rios e gere relat√≥rios.">
    <meta name="theme-color" content="#3b82f6">
    <meta name="keywords" content="ponto eletr√¥nico, controle de horas, calcular sal√°rio, registro de ponto">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Controle de Ponto Digital">
    <meta property="og:description" content="Sistema gratuito para controle de ponto eletr√¥nico">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è∞</text></svg>">
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --secondary-dark: #047857;
            --accent: #8b5cf6;
            --accent-dark: #7c3aed;
            --neutral: #6b7280;
            --neutral-dark: #4b5563;
            --light: #f9fafb;
            --dark: #1f2937;
        }
        
        .tab-active {
            background-color: var(--primary);
            color: white;
        }
        .exceeded {
            background-color: #fee2e2;
        }
        .print-only {
            display: none;
        }
        .dashboard-card {
            transition: all 0.3s ease;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .time-entry {
            transition: all 0.3s ease;
        }
        .time-entry:hover {
            background-color: #f8fafc;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                font-size: 12px;
            }
            .container {
                max-width: 100% !important;
            }
        }
        .dark-mode {
            background-color: var(--dark);
            color: var(--light);
        }
        .dark-mode .bg-white {
            background-color: #374151;
        }
        .dark-mode .bg-gray-100 {
            background-color: #4b5563;
        }
        .dark-mode .border-gray-300 {
            border-color: #6b7280;
        }
        .dark-mode input, .dark-mode select {
            background-color: #4b5563;
            color: var(--light);
            border-color: #6b7280;
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            background: linear-gradient(145deg, #ffffff, #f3f4f6);
        }
        .hidden {
            display: none;
        }
        .admin-panel {
            background-color: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        /* Melhorias para mobile */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .grid-cols-1, .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: 1fr !important;
            }
            .flex-wrap {
                flex-direction: column;
            }
            .month-tab {
                margin-bottom: 5px;
                text-align: center;
                padding: 10px 5px;
                font-size: 0.875rem;
            }
            .header-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .header-buttons button {
                width: 100%;
            }
            .login-container {
                margin: 20px auto;
                padding: 20px;
            }
            .modern-card {
                padding: 16px;
            }
            .modern-tabs {
                flex-direction: column;
            }
            .modern-tab {
                margin-bottom: 5px;
            }
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--secondary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.error {
            background: #ef4444;
        }
        .toast.warning {
            background: #f59e0b;
        }
        
        /* Bot√µes modernos */
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
        }
        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }
        
        .btn-accent {
            background-color: var(--accent);
            color: white;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
        }
        .btn-accent:hover {
            background-color: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
        }
        
        /* Cards modernos */
        .modern-card {
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 24px;
            background: white;
            transition: all 0.3s ease;
        }
        .modern-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Inputs modernos */
        .modern-input {
            border-radius: 8px;
            border: 1px solid #d1d5db;
            padding: 12px;
            width: 100%;
            transition: all 0.2s ease;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            box-sizing: border-box;
        }
        .modern-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Abas modernas */
        .modern-tabs {
            display: flex;
            border-radius: 12px;
            background-color: #f3f4f6;
            padding: 4px;
        }
        .modern-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .modern-tab.active {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Indicador de modo de trabalho */
        .work-mode-indicator {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .work-mode-horista {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }
        .work-mode-mensalista {
            background-color: rgba(139, 92, 246, 0.1);
            color: var(--accent);
        }

        /* Melhorias para tabelas em mobile */
        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }
            table {
                min-width: 600px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-blue-600">‚è∞ Controle de Ponto</h1>
            <p class="text-gray-600 mt-2">Sistema gratuito de ponto eletr√¥nico</p>
        </div>
        
        <div id="loginForm">
            <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
            <div class="mb-4">
                <label for="loginUsername" class="block text-sm font-medium text-gray-700 mb-1">Usu√°rio:</label>
                <input type="text" id="loginUsername" class="modern-input" required>
            </div>
            <div class="mb-4">
                <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Senha:</label>
                <input type="password" id="loginPassword" class="modern-input" required>
            </div>
            <div class="mb-4">
                <button id="loginBtn" class="btn-primary w-full flex items-center justify-center">
                    <span id="loginText">Entrar</span>
                    <div id="loginLoading" class="loading hidden ml-2"></div>
                </button>
            </div>
            <p class="text-center text-sm">
                N√£o tem uma conta? 
                <a href="#" id="showRegister" class="text-blue-500 hover:text-blue-700 font-medium">Cadastre-se</a>
            </p>
        </div>
        
        <div id="registerForm" class="hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Cadastro</h2>
            <div class="mb-4">
                <label for="registerUsername" class="block text-sm font-medium text-gray-700 mb-1">Usu√°rio:</label>
                <input type="text" id="registerUsername" class="modern-input" required minlength="3">
                <p class="text-xs text-gray-500 mt-1">M√≠nimo 3 caracteres</p>
            </div>
            <div class="mb-4">
                <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-1">Senha:</label>
                <input type="password" id="registerPassword" class="modern-input" required minlength="4">
                <p class="text-xs text-gray-500 mt-1">M√≠nimo 4 caracteres</p>
            </div>
            <div class="mb-4">
                <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Senha:</label>
                <input type="password" id="confirmPassword" class="modern-input" required>
            </div>
            <div class="mb-4">
                <button id="registerBtn" class="btn-secondary w-full flex items-center justify-center">
                    <span id="registerText">Cadastrar</span>
                    <div id="registerLoading" class="loading hidden ml-2"></div>
                </button>
            </div>
            <p class="text-center text-sm">
                J√° tem uma conta? 
                <a href="#" id="showLogin" class="text-blue-500 hover:text-blue-700 font-medium">Fa√ßa login</a>
            </p>
        </div>

        <!-- Informa√ß√µes do sistema -->
        <div class="mt-8 p-4 bg-blue-50 rounded-lg">
            <h3 class="font-bold text-blue-800 mb-2">üí° Como usar:</h3>
            <ul class="text-sm text-blue-700 space-y-1">
                <li>‚Ä¢ Cadastre-se e fa√ßa login</li>
                <li>‚Ä¢ Registre seus hor√°rios de trabalho</li>
                <li>‚Ä¢ Configure o valor da sua hora/aula</li>
                <li>‚Ä¢ Acompanhe relat√≥rios e c√°lculos autom√°ticos</li>
                <li>‚Ä¢ Todos os dados ficam salvos na nuvem</li>
            </ul>
        </div>
    </div>

    <!-- Painel Administrativo -->
    <div id="adminScreen" class="container mx-auto px-4 py-8 hidden">
        <header class="mb-8">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">‚öôÔ∏è Painel Administrativo</h1>
                    <p class="text-gray-600 mt-2">Gerenciamento de usu√°rios do sistema</p>
                </div>
                <button id="adminLogoutBtn" class="btn-primary bg-red-500 hover:bg-red-600">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </header>

        <div class="admin-panel">
            <h2 class="text-xl font-bold mb-4">üë• Gerenciar Usu√°rios</h2>
            
            <div class="mb-6">
                <h3 class="font-medium mb-2">üîê Alterar Senha do Admin</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-1">Senha Atual:</label>
                        <input type="password" id="currentPassword" class="modern-input">
                    </div>
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">Nova Senha:</label>
                        <input type="password" id="newPassword" class="modern-input" minlength="4">
                    </div>
                    <div>
                        <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Nova Senha:</label>
                        <input type="password" id="confirmNewPassword" class="modern-input">
                    </div>
                </div>
                <button id="changeAdminPassword" class="btn-primary">
                    Alterar Senha
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="font-medium mb-2">üìã Lista de Usu√°rios</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2 text-left">Usu√°rio</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usersList">
                            <!-- Lista de usu√°rios ser√° preenchida via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium mb-2">‚ûï Criar Novo Usu√°rio</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label for="newUsername" class="block text-sm font-medium text-gray-700 mb-1">Usu√°rio:</label>
                        <input type="text" id="newUsername" class="modern-input" minlength="3">
                    </div>
                    <div>
                        <label for="newUserPassword" class="block text-sm font-medium text-gray-700 mb-1">Senha:</label>
                        <input type="password" id="newUserPassword" class="modern-input" minlength="4">
                    </div>
                    <div>
                        <label for="confirmNewUserPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Senha:</label>
                        <input type="password" id="confirmNewUserPassword" class="modern-input">
                    </div>
                </div>
                <button id="createUserBtn" class="btn-secondary">
                    Criar Usu√°rio
                </button>
            </div>
        </div>
    </div>

    <!-- Sistema de Controle de Ponto (ap√≥s login) -->
    <div id="appScreen" class="container mx-auto px-4 py-8 hidden">
        <!-- Cabe√ßalho -->
        <header class="mb-8">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">‚è∞ Controle de Ponto Digital</h1>
                    <div class="flex items-center mt-2">
                        <p class="text-gray-600">Bem-vindo, <span id="userWelcome" class="font-semibold"></span>!</p>
                        <span id="workModeIndicator" class="work-mode-indicator ml-3"></span>
                    </div>
                </div>
                <div class="flex space-x-4 header-buttons">
                    <button id="darkModeToggle" class="btn-primary bg-gray-200 hover:bg-gray-300 text-gray-800 no-print">
                        <i class="fas fa-moon"></i> Modo Escuro
                    </button>
                    <button id="exportBtn" class="btn-primary no-print">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                    <button id="importBtn" class="btn-secondary no-print">
                        <i class="fas fa-upload"></i> Importar
                    </button>
                    <input type="file" id="importFile" class="hidden" accept=".json">
                    <button id="logoutBtn" class="btn-primary bg-red-500 hover:bg-red-600 no-print">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Dashboard Resumo -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 no-print">
            <div class="dashboard-card modern-card">
                <div class="flex items-center">
                    <div class="bg-blue-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-clock text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Horas Este Per√≠odo</p>
                        <p class="text-2xl font-bold text-gray-800" id="dashboardHorasMes">00:00</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card modern-card">
                <div class="flex items-center">
                    <div class="bg-green-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-money-bill-wave text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Sal√°rio Este Per√≠odo</p>
                        <p class="text-2xl font-bold text-gray-800" id="dashboardSalarioMes">R$ 0,00</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card modern-card">
                <div class="flex items-center">
                    <div class="bg-purple-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">M√©dia Horas/Semana</p>
                        <p class="text-2xl font-bold text-gray-800" id="dashboardMediaSemanal">00:00</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card modern-card">
                <div class="flex items-center">
                    <div class="bg-orange-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-bolt text-orange-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Horas Extras</p>
                        <p class="text-2xl font-bold text-gray-800" id="dashboardHorasExtras">00:00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controle de modo de trabalho -->
        <div class="mb-6 no-print">
            <div class="modern-card">
                <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Configura√ß√µes de Trabalho</h2>
                <div class="modern-tabs mb-4">
                    <div class="modern-tab active" data-mode="horista">
                        <i class="fas fa-clock mr-2"></i> Horista
                    </div>
                    <div class="modern-tab" data-mode="mensalista">
                        <i class="fas fa-calendar-alt mr-2"></i> Mensalista
                    </div>
                </div>
                
                <!-- Configura√ß√µes espec√≠ficas para mensalista -->
                <div id="mensalistaConfig" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="cargaHorariaMensal" class="block text-sm font-medium text-gray-700 mb-1">Carga Hor√°ria Mensal (horas):</label>
                            <input type="number" id="cargaHorariaMensal" class="modern-input" min="0" value="160">
                        </div>
                        <div>
                            <label for="salarioMensal" class="block text-sm font-medium text-gray-700 mb-1">Sal√°rio Mensal (R$):</label>
                            <input type="number" id="salarioMensal" class="modern-input" min="0" step="0.01" value="3000.00">
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="font-medium text-blue-800 mb-2">Status do Per√≠odo</h3>
                        <div class="flex justify-between">
                            <span>Horas Trabalhadas:</span>
                            <span id="horasTrabalhadasMensal">00:00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Horas a Compensar/Pagar:</span>
                            <span id="horasCompensar">00:00</span>
                        </div>
                        <div class="flex justify-between font-bold mt-2">
                            <span>Valor a Compensar/Pagar:</span>
                            <span id="valorCompensar">R$ 0,00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Per√≠odo de C√°lculo -->
        <div class="mb-6 no-print">
            <div class="modern-card">
                <h2 class="text-xl font-bold mb-4">üìÖ Per√≠odo de C√°lculo</h2>
                
                <div class="mb-4">
                    <label class="flex items-center mb-2">
                        <input type="radio" name="periodType" value="standard" class="mr-2" checked>
                        <span>Per√≠odo Padr√£o (16/M√™s Atual - 15/Pr√≥ximo M√™s)</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="periodType" value="custom" class="mr-2">
                        <span>Per√≠odo Personalizado</span>
                    </label>
                </div>
                
                <div id="customPeriodConfig" class="hidden">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="periodStartDay" class="block text-sm font-medium text-gray-700 mb-1">
                                Dia de In√≠cio do Per√≠odo:
                            </label>
                            <input type="number" id="periodStartDay" class="modern-input" min="1" max="31" value="16">
                        </div>
                        <div>
                            <label for="periodEndDay" class="block text-sm font-medium text-gray-700 mb-1">
                                Dia de T√©rmino (autom√°tico):
                            </label>
                            <input type="number" id="periodEndDay" class="modern-input" disabled value="15">
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="font-medium text-blue-800 mb-2">Per√≠odo Atual de C√°lculo:</h3>
                    <p id="currentPeriodDisplay" class="text-blue-700"></p>
                </div>
            </div>
        </div>

        <!-- Conte√∫do principal -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Formul√°rio de registro -->
            <div class="modern-card no-print">
                <h2 class="text-xl font-bold mb-4">üìù Registrar Ponto</h2>
                <form id="pontoForm">
                    <div class="mb-4">
                        <label for="data" class="block text-sm font-medium text-gray-700 mb-1">Data:</label>
                        <input type="date" id="data" class="modern-input" required>
                    </div>
                    
                    <!-- Entradas e Sa√≠das Principais -->
                    <div class="mb-4">
                        <h3 class="font-medium mb-2 text-gray-700">Per√≠odo Principal</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="entrada" class="block text-sm font-medium text-gray-700 mb-1">Entrada:</label>
                                <input type="time" id="entrada" class="modern-input" required>
                            </div>
                            <div>
                                <label for="saida" class="block text-sm font-medium text-gray-700 mb-1">Sa√≠da:</label>
                                <input type="time" id="saida" class="modern-input" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Intervalos -->
                    <div class="mb-4">
                        <h3 class="font-medium mb-2 text-gray-700">Intervalos</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="intervaloSaida" class="block text-sm font-medium text-gray-700 mb-1">Sa√≠da Intervalo:</label>
                                <input type="time" id="intervaloSaida" class="modern-input">
                            </div>
                            <div>
                                <label for="intervaloRetorno" class="block text-sm font-medium text-gray-700 mb-1">Retorno Intervalo:</label>
                                <input type="time" id="intervaloRetorno" class="modern-input">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Entradas e Sa√≠das Adicionais -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-gray-700">Entradas/Sa√≠das Adicionais</h3>
                            <button type="button" id="adicionarHorario" class="btn-primary text-sm">
                                <i class="fas fa-plus"></i> Adicionar
                            </button>
                        </div>
                        <div id="horariosAdicionais" class="space-y-2">
                            <!-- Hor√°rios adicionais ser√£o inseridos aqui -->
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes (opcional):</label>
                        <textarea id="observacoes" class="modern-input" rows="2" placeholder="Anota√ß√µes sobre o dia..."></textarea>
                    </div>
                    
                    <div class="flex justify-between gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save"></i> Salvar Registro
                        </button>
                        <button type="button" id="limparForm" class="btn-primary bg-gray-500 hover:bg-gray-600">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </form>
            </div>

            <!-- Configura√ß√µes de sal√°rio por hora/aula -->
            <div class="modern-card no-print">
                <h2 class="text-xl font-bold mb-4">üí∞ Configura√ß√µes de Sal√°rio</h2>
                
                <div class="mb-6">
                    <label for="valorHoraAula" class="block text-sm font-medium text-gray-700 mb-1">Valor da Hora/Aula (R$):</label>
                    <input type="number" id="valorHoraAula" step="0.01" min="0" class="modern-input" value="50.00">
                    <p class="text-xs text-gray-500 mt-1">Este valor ser√° usado para calcular seu sal√°rio</p>
                </div>

                <div class="mb-4">
                    <label for="valorHoraExtra" class="block text-sm font-medium text-gray-700 mb-1">Valor da Hora Extra (%):</label>
                    <input type="number" id="valorHoraExtra" step="1" min="0" class="modern-input" value="50">
                    <p class="text-xs text-gray-500 mt-1">Percentual de acr√©scimo para horas extras</p>
                </div>
                
                <div class="mb-4">
                    <h3 class="font-medium mb-2">üìä C√°lculo Autom√°tico</h3>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between mb-2">
                            <span>Total de Horas:</span>
                            <span id="infoTotalHoras">0h 0min</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Horas Extras:</span>
                            <span id="infoHorasExtras">0h 0min</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Valor Hora/Aula:</span>
                            <span id="infoValorHora">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between font-bold border-t pt-2">
                            <span>Sal√°rio Bruto:</span>
                            <span id="infoSalarioBruto">R$ 0,00</span>
                        </div>
                    </div>
                </div>
                
                <h3 class="font-medium mb-2">üìâ Descontos Adicionais:</h3>
                <div id="descontosContainer" class="mb-4">
                    <!-- Descontos ser√£o adicionados aqui -->
                </div>
                
                <button id="adicionarDesconto" class="btn-primary bg-gray-500 hover:bg-gray-600 w-full mb-4">
                    <i class="fas fa-plus"></i> Adicionar Desconto
                </button>
                
                <button id="calcularSalario" class="btn-secondary w-full">
                    <i class="fas fa-calculator"></i> Calcular Sal√°rio Completo
                </button>
            </div>

            <!-- Resumo e gr√°ficos -->
            <div class="modern-card">
                <h2 class="text-xl font-bold mb-4">üìà Resumo do Per√≠odo</h2>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <p class="text-sm text-blue-700">Horas Trabalhadas</p>
                        <p class="text-2xl font-bold text-blue-800" id="resumoHorasTrabalhadas">00:00</p>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <p class="text-sm text-green-700">Sal√°rio Bruto</p>
                        <p class="text-2xl font-bold text-green-800" id="resumoSalarioBruto">R$ 0,00</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-medium mb-2">Horas por Dia</h3>
                    <div class="h-48">
                        <canvas id="horasChart"></canvas>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Distribui√ß√£o de Horas</h3>
                    <div class="h-48">
                        <canvas id="distribuicaoChart"></canvas>
                    </div>
                </div>
                
                <div class="flex justify-between mt-4 no-print">
                    <button id="imprimirRelatorio" class="btn-primary">
                        <i class="fas fa-print"></i> Imprimir Relat√≥rio
                    </button>
                    <button id="exportarDados" class="btn-secondary">
                        <i class="fas fa-file-export"></i> Exportar Dados
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabela de registros -->
        <div class="mt-8 modern-card">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üìã Registros de Ponto</h2>
                <div class="flex space-x-2">
                    <button id="filtrarRegistros" class="btn-primary text-sm">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                    <button id="limparFiltros" class="btn-primary bg-gray-500 hover:bg-gray-600 text-sm">
                        <i class="fas fa-times"></i> Limpar Filtros
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 px-4 py-2 text-left">Data</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Entrada</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Sa√≠da</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Intervalo</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Total</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Observa√ß√µes</th>
                            <th class="border border-gray-300 px-4 py-2 text-left no-print">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="registrosTabela">
                        <!-- Registros ser√£o preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal para edi√ß√£o de registro -->
    <div id="editarModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 class="text-xl font-bold mb-4">Editar Registro</h2>
            <form id="editarForm">
                <input type="hidden" id="editarId">
                <div class="mb-4">
                    <label for="editarData" class="block text-sm font-medium text-gray-700 mb-1">Data:</label>
                    <input type="date" id="editarData" class="modern-input" required>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="editarEntrada" class="block text-sm font-medium text-gray-700 mb-1">Entrada:</label>
                        <input type="time" id="editarEntrada" class="modern-input" required>
                    </div>
                    <div>
                        <label for="editarSaida" class="block text-sm font-medium text-gray-700 mb-1">Sa√≠da:</label>
                        <input type="time" id="editarSaida" class="modern-input" required>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="editarIntervaloSaida" class="block text-sm font-medium text-gray-700 mb-1">Sa√≠da Intervalo:</label>
                        <input type="time" id="editarIntervaloSaida" class="modern-input">
                    </div>
                    <div>
                        <label for="editarIntervaloRetorno" class="block text-sm font-medium text-gray-700 mb-1">Retorno Intervalo:</label>
                        <input type="time" id="editarIntervaloRetorno" class="modern-input">
                    </div>
                </div>
                <div class="mb-4">
                    <label for="editarObservacoes" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes:</label>
                    <textarea id="editarObservacoes" class="modern-input" rows="2"></textarea>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancelarEdicao" class="btn-primary bg-gray-500 hover:bg-gray-600">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-secondary">
                        Salvar Altera√ß√µes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configura√ß√£o da API JSONBin
        const API_CONFIG = {
            BIN_ID: '67f9e7a0ad19ca34f8d8e5c1',
            API_KEY: '$2a$10$h.9Gt6v7v.V8p4p6p5v6v.V8p4p6p5v6v.V8p4p6p5v6v.V8p4p6p5v6v'
        };

        // Estado da aplica√ß√£o
        let state = {
            registros: [],
            usuarioAtual: null,
            modoTrabalho: 'horista', // 'horista' ou 'mensalista'
            periodoCalculo: {
                tipo: 'standard', // 'standard' ou 'custom'
                diaInicio: 16,
                diaFim: 15
            },
            valorHoraAula: 50.00,
            valorHoraExtra: 50, // Percentual
            descontos: [],
            usuarios: [],
            admin: false
        };

        // Elementos DOM
        const elementos = {
            // Telas
            loginScreen: document.getElementById('loginScreen'),
            appScreen: document.getElementById('appScreen'),
            adminScreen: document.getElementById('adminScreen'),
            
            // Login
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            loginUsername: document.getElementById('loginUsername'),
            loginPassword: document.getElementById('loginPassword'),
            loginBtn: document.getElementById('loginBtn'),
            loginText: document.getElementById('loginText'),
            loginLoading: document.getElementById('loginLoading'),
            showRegister: document.getElementById('showRegister'),
            registerUsername: document.getElementById('registerUsername'),
            registerPassword: document.getElementById('registerPassword'),
            confirmPassword: document.getElementById('confirmPassword'),
            registerBtn: document.getElementById('registerBtn'),
            registerText: document.getElementById('registerText'),
            registerLoading: document.getElementById('registerLoading'),
            showLogin: document.getElementById('showLogin'),
            
            // App principal
            userWelcome: document.getElementById('userWelcome'),
            workModeIndicator: document.getElementById('workModeIndicator'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            exportBtn: document.getElementById('exportBtn'),
            importBtn: document.getElementById('importBtn'),
            importFile: document.getElementById('importFile'),
            logoutBtn: document.getElementById('logoutBtn'),
            
            // Dashboard
            dashboardHorasMes: document.getElementById('dashboardHorasMes'),
            dashboardSalarioMes: document.getElementById('dashboardSalarioMes'),
            dashboardMediaSemanal: document.getElementById('dashboardMediaSemanal'),
            dashboardHorasExtras: document.getElementById('dashboardHorasExtras'),
            
            // Modo de trabalho
            mensalistaConfig: document.getElementById('mensalistaConfig'),
            cargaHorariaMensal: document.getElementById('cargaHorariaMensal'),
            salarioMensal: document.getElementById('salarioMensal'),
            horasTrabalhadasMensal: document.getElementById('horasTrabalhadasMensal'),
            horasCompensar: document.getElementById('horasCompensar'),
            valorCompensar: document.getElementById('valorCompensar'),
            
            // Per√≠odo de c√°lculo
            periodTypeRadios: document.getElementsByName('periodType'),
            customPeriodConfig: document.getElementById('customPeriodConfig'),
            periodStartDay: document.getElementById('periodStartDay'),
            periodEndDay: document.getElementById('periodEndDay'),
            currentPeriodDisplay: document.getElementById('currentPeriodDisplay'),
            
            // Formul√°rio de ponto
            pontoForm: document.getElementById('pontoForm'),
            data: document.getElementById('data'),
            entrada: document.getElementById('entrada'),
            saida: document.getElementById('saida'),
            intervaloSaida: document.getElementById('intervaloSaida'),
            intervaloRetorno: document.getElementById('intervaloRetorno'),
            observacoes: document.getElementById('observacoes'),
            adicionarHorario: document.getElementById('adicionarHorario'),
            horariosAdicionais: document.getElementById('horariosAdicionais'),
            limparForm: document.getElementById('limparForm'),
            
            // Configura√ß√µes de sal√°rio
            valorHoraAula: document.getElementById('valorHoraAula'),
            valorHoraExtra: document.getElementById('valorHoraExtra'),
            infoTotalHoras: document.getElementById('infoTotalHoras'),
            infoHorasExtras: document.getElementById('infoHorasExtras'),
            infoValorHora: document.getElementById('infoValorHora'),
            infoSalarioBruto: document.getElementById('infoSalarioBruto'),
            descontosContainer: document.getElementById('descontosContainer'),
            adicionarDesconto: document.getElementById('adicionarDesconto'),
            calcularSalario: document.getElementById('calcularSalario'),
            
            // Resumo
            resumoHorasTrabalhadas: document.getElementById('resumoHorasTrabalhadas'),
            resumoSalarioBruto: document.getElementById('resumoSalarioBruto'),
            imprimirRelatorio: document.getElementById('imprimirRelatorio'),
            exportarDados: document.getElementById('exportarDados'),
            
            // Tabela de registros
            registrosTabela: document.getElementById('registrosTabela'),
            filtrarRegistros: document.getElementById('filtrarRegistros'),
            limparFiltros: document.getElementById('limparFiltros'),
            
            // Modal de edi√ß√£o
            editarModal: document.getElementById('editarModal'),
            editarForm: document.getElementById('editarForm'),
            editarId: document.getElementById('editarId'),
            editarData: document.getElementById('editarData'),
            editarEntrada: document.getElementById('editarEntrada'),
            editarSaida: document.getElementById('editarSaida'),
            editarIntervaloSaida: document.getElementById('editarIntervaloSaida'),
            editarIntervaloRetorno: document.getElementById('editarIntervaloRetorno'),
            editarObservacoes: document.getElementById('editarObservacoes'),
            cancelarEdicao: document.getElementById('cancelarEdicao'),
            
            // Toast
            toast: document.getElementById('toast'),
            
            // Admin
            adminLogoutBtn: document.getElementById('adminLogoutBtn'),
            currentPassword: document.getElementById('currentPassword'),
            newPassword: document.getElementById('newPassword'),
            confirmNewPassword: document.getElementById('confirmNewPassword'),
            changeAdminPassword: document.getElementById('changeAdminPassword'),
            usersList: document.getElementById('usersList'),
            newUsername: document.getElementById('newUsername'),
            newUserPassword: document.getElementById('newUserPassword'),
            confirmNewUserPassword: document.getElementById('confirmNewUserPassword'),
            createUserBtn: document.getElementById('createUserBtn')
        };

        // Fun√ß√µes utilit√°rias
        const utils = {
            // Converter minutos para formato HH:MM
            minutosParaHoras: (minutos) => {
                const horas = Math.floor(minutos / 60);
                const mins = minutos % 60;
                return `${horas.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            },
            
            // Converter formato HH:MM para minutos
            horasParaMinutos: (horasStr) => {
                const [horas, minutos] = horasStr.split(':').map(Number);
                return horas * 60 + minutos;
            },
            
            // Formatar valor monet√°rio
            formatarMoeda: (valor) => {
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(valor);
            },
            
            // Formatar data para exibi√ß√£o
            formatarData: (dataStr) => {
                const data = new Date(dataStr);
                return data.toLocaleDateString('pt-BR');
            },
            
            // Obter data atual no formato YYYY-MM-DD
            dataAtual: () => {
                return new Date().toISOString().split('T')[0];
            },
            
            // Calcular diferen√ßa entre dois hor√°rios em minutos
            calcularDiferencaHorarios: (inicio, fim) => {
                const inicioMinutos = utils.horasParaMinutos(inicio);
                const fimMinutos = utils.horasParaMinutos(fim);
                return fimMinutos - inicioMinutos;
            },
            
            // Calcular total de horas trabalhadas em um dia
            calcularHorasDia: (registro) => {
                let totalMinutos = 0;
                
                // Hor√°rio principal
                if (registro.entrada && registro.saida) {
                    totalMinutos += utils.calcularDiferencaHorarios(registro.entrada, registro.saida);
                }
                
                // Intervalo (subtrair)
                if (registro.intervaloSaida && registro.intervaloRetorno) {
                    totalMinutos -= utils.calcularDiferencaHorarios(registro.intervaloSaida, registro.intervaloRetorno);
                }
                
                // Hor√°rios adicionais
                if (registro.horariosAdicionais) {
                    registro.horariosAdicionais.forEach(horario => {
                        if (horario.entrada && horario.saida) {
                            totalMinutos += utils.calcularDiferencaHorarios(horario.entrada, horario.saida);
                        }
                    });
                }
                
                return totalMinutos;
            },
            
            // Mostrar notifica√ß√£o toast
            mostrarToast: (mensagem, tipo = 'success') => {
                elementos.toast.textContent = mensagem;
                elementos.toast.className = `toast ${tipo}`;
                elementos.toast.classList.remove('hidden');
                elementos.toast.classList.add('show');
                
                setTimeout(() => {
                    elementos.toast.classList.remove('show');
                    setTimeout(() => {
                        elementos.toast.classList.add('hidden');
                    }, 300);
                }, 3000);
            },
            
            // Gerar ID √∫nico
            gerarId: () => {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
        };

        // Fun√ß√µes de API
        const api = {
            // Buscar dados do JSONBin
            buscarDados: async () => {
                try {
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${API_CONFIG.BIN_ID}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': API_CONFIG.API_KEY,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Erro ao buscar dados');
                    }
                    
                    const data = await response.json();
                    return data.record || {};
                } catch (error) {
                    console.error('Erro ao buscar dados:', error);
                    utils.mostrarToast('Erro ao carregar dados. Verifique sua conex√£o.', 'error');
                    return {};
                }
            },
            
            // Salvar dados no JSONBin
            salvarDados: async (dados) => {
                try {
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${API_CONFIG.BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'X-Master-Key': API_CONFIG.API_KEY,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dados)
                    });
                    
                    if (!response.ok) {
                        throw new Error('Erro ao salvar dados');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    utils.mostrarToast('Erro ao salvar dados. Verifique sua conex√£o.', 'error');
                    return null;
                }
            }
        };

        // Fun√ß√µes de gerenciamento de estado
        const stateManager = {
            // Carregar estado inicial
            carregarEstado: async () => {
                const dados = await api.buscarDados();
                
                if (dados.registros) {
                    state.registros = dados.registros;
                }
                
                if (dados.usuarios) {
                    state.usuarios = dados.usuarios;
                }
                
                if (dados.configuracoes) {
                    state.modoTrabalho = dados.configuracoes.modoTrabalho || 'horista';
                    state.periodoCalculo = dados.configuracoes.periodoCalculo || state.periodoCalculo;
                    state.valorHoraAula = dados.configuracoes.valorHoraAula || 50.00;
                    state.valorHoraExtra = dados.configuracoes.valorHoraExtra || 50;
                    state.descontos = dados.configuracoes.descontos || [];
                }
                
                // Atualizar UI
                stateManager.atualizarUI();
            },
            
            // Salvar estado
            salvarEstado: async () => {
                const dados = {
                    registros: state.registros,
                    usuarios: state.usuarios,
                    configuracoes: {
                        modoTrabalho: state.modoTrabalho,
                        periodoCalculo: state.periodoCalculo,
                        valorHoraAula: state.valorHoraAula,
                        valorHoraExtra: state.valorHoraExtra,
                        descontos: state.descontos
                    }
                };
                
                await api.salvarDados(dados);
            },
            
            // Atualizar interface com base no estado
            atualizarUI: () => {
                // Atualizar modo de trabalho
                stateManager.atualizarModoTrabalhoUI();
                
                // Atualizar per√≠odo de c√°lculo
                stateManager.atualizarPeriodoCalculoUI();
                
                // Atualizar configura√ß√µes de sal√°rio
                elementos.valorHoraAula.value = state.valorHoraAula;
                elementos.valorHoraExtra.value = state.valorHoraExtra;
                
                // Atualizar dashboard
                stateManager.atualizarDashboard();
                
                // Atualizar tabela de registros
                stateManager.atualizarTabelaRegistros();
                
                // Atualizar resumo
                stateManager.atualizarResumo();
                
                // Atualizar descontos
                stateManager.atualizarDescontosUI();
            },
            
            // Atualizar UI do modo de trabalho
            atualizarModoTrabalhoUI: () => {
                // Atualizar abas
                document.querySelectorAll('.modern-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.mode === state.modoTrabalho) {
                        tab.classList.add('active');
                    }
                });
                
                // Mostrar/ocultar configura√ß√µes espec√≠ficas
                if (state.modoTrabalho === 'mensalista') {
                    elementos.mensalistaConfig.classList.remove('hidden');
                    elementos.workModeIndicator.textContent = 'Mensalista';
                    elementos.workModeIndicator.className = 'work-mode-indicator work-mode-mensalista';
                } else {
                    elementos.mensalistaConfig.classList.add('hidden');
                    elementos.workModeIndicator.textContent = 'Horista';
                    elementos.workModeIndicator.className = 'work-mode-indicator work-mode-horista';
                }
                
                // Atualizar c√°lculos para mensalista
                if (state.modoTrabalho === 'mensalista') {
                    stateManager.calcularMensalista();
                }
            },
            
            // Atualizar UI do per√≠odo de c√°lculo
            atualizarPeriodoCalculoUI: () => {
                // Atualizar radios
                elementos.periodTypeRadios.forEach(radio => {
                    radio.checked = radio.value === state.periodoCalculo.tipo;
                });
                
                // Mostrar/ocultar configura√ß√µes personalizadas
                if (state.periodoCalculo.tipo === 'custom') {
                    elementos.customPeriodConfig.classList.remove('hidden');
                    elementos.periodStartDay.value = state.periodoCalculo.diaInicio;
                    elementos.periodEndDay.value = state.periodoCalculo.diaFim;
                } else {
                    elementos.customPeriodConfig.classList.add('hidden');
                }
                
                // Atualizar display do per√≠odo atual
                stateManager.atualizarDisplayPeriodoAtual();
            },
            
            // Atualizar display do per√≠odo atual
            atualizarDisplayPeriodoAtual: () => {
                const hoje = new Date();
                const ano = hoje.getFullYear();
                const mes = hoje.getMonth();
                
                let inicioPeriodo, fimPeriodo;
                
                if (state.periodoCalculo.tipo === 'standard') {
                    // Per√≠odo padr√£o: 16 do m√™s atual a 15 do pr√≥ximo m√™s
                    inicioPeriodo = new Date(ano, mes, 16);
                    fimPeriodo = new Date(ano, mes + 1, 15);
                } else {
                    // Per√≠odo personalizado
                    inicioPeriodo = new Date(ano, mes, state.periodoCalculo.diaInicio);
                    fimPeriodo = new Date(ano, mes + 1, state.periodoCalculo.diaFim);
                }
                
                elementos.currentPeriodDisplay.textContent = 
                    `${utils.formatarData(inicioPeriodo.toISOString())} a ${utils.formatarData(fimPeriodo.toISOString())}`;
            },
            
            // Atualizar dashboard
            atualizarDashboard: () => {
                const periodoAtual = stateManager.obterPeriodoAtual();
                const registrosPeriodo = state.registros.filter(registro => {
                    const dataRegistro = new Date(registro.data);
                    return dataRegistro >= periodoAtual.inicio && dataRegistro <= periodoAtual.fim;
                });
                
                // Calcular totais
                let totalMinutos = 0;
                let totalMinutosExtras = 0;
                
                registrosPeriodo.forEach(registro => {
                    const minutosDia = utils.calcularHorasDia(registro);
                    totalMinutos += minutosDia;
                    
                    // Considerar horas extras (acima de 8h por dia)
                    if (minutosDia > 8 * 60) {
                        totalMinutosExtras += minutosDia - (8 * 60);
                    }
                });
                
                // Calcular sal√°rio
                let salario = 0;
                
                if (state.modoTrabalho === 'horista') {
                    // Horista: valor por hora * total de horas
                    const horasNormais = Math.max(0, totalMinutos - totalMinutosExtras);
                    salario = (horasNormais / 60) * state.valorHoraAula;
                    salario += (totalMinutosExtras / 60) * state.valorHoraAula * (1 + state.valorHoraExtra / 100);
                } else {
                    // Mensalista: sal√°rio fixo + compensa√ß√£o de horas extras
                    const cargaHorariaMensal = parseFloat(elementos.cargaHorariaMensal.value) || 160;
                    const salarioMensal = parseFloat(elementos.salarioMensal.value) || 3000;
                    const valorHora = salarioMensal / cargaHorariaMensal;
                    
                    const horasTrabalhadas = totalMinutos / 60;
                    const diferencaHoras = horasTrabalhadas - cargaHorariaMensal;
                    
                    if (diferencaHoras > 0) {
                        // Horas extras
                        salario = salarioMensal + (diferencaHoras * valorHora * (1 + state.valorHoraExtra / 100));
                    } else if (diferencaHoras < 0) {
                        // Horas faltantes (desconto)
                        salario = salarioMensal + (diferencaHoras * valorHora);
                    } else {
                        salario = salarioMensal;
                    }
                }
                
                // Aplicar descontos
                state.descontos.forEach(desconto => {
                    salario -= desconto.valor;
                });
                
                // Atualizar elementos
                elementos.dashboardHorasMes.textContent = utils.minutosParaHoras(totalMinutos);
                elementos.dashboardSalarioMes.textContent = utils.formatarMoeda(Math.max(0, salario));
                elementos.dashboardHorasExtras.textContent = utils.minutosParaHoras(totalMinutosExtras);
                
                // Calcular m√©dia semanal
                const semanas = Math.max(1, Math.ceil((periodoAtual.fim - periodoAtual.inicio) / (1000 * 60 * 60 * 24 * 7)));
                const mediaSemanal = totalMinutos / semanas;
                elementos.dashboardMediaSemanal.textContent = utils.minutosParaHoras(mediaSemanal);
            },
            
            // Atualizar tabela de registros
            atualizarTabelaRegistros: () => {
                elementos.registrosTabela.innerHTML = '';
                
                if (state.registros.length === 0) {
                    elementos.registrosTabela.innerHTML = `
                        <tr>
                            <td colspan="7" class="border border-gray-300 px-4 py-2 text-center text-gray-500">
                                Nenhum registro encontrado. Adicione seu primeiro registro!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Ordenar registros por data (mais recente primeiro)
                const registrosOrdenados = [...state.registros].sort((a, b) => 
                    new Date(b.data) - new Date(a.data)
                );
                
                registrosOrdenados.forEach(registro => {
                    const totalMinutos = utils.calcularHorasDia(registro);
                    const totalHoras = utils.minutosParaHoras(totalMinutos);
                    
                    const tr = document.createElement('tr');
                    tr.className = 'time-entry';
                    
                    // Destacar dias com mais de 8 horas
                    if (totalMinutos > 8 * 60) {
                        tr.classList.add('exceeded');
                    }
                    
                    tr.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2">${utils.formatarData(registro.data)}</td>
                        <td class="border border-gray-300 px-4 py-2">${registro.entrada || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2">${registro.saida || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            ${registro.intervaloSaida && registro.intervaloRetorno ? 
                                `${registro.intervaloSaida} - ${registro.intervaloRetorno}` : '-'}
                        </td>
                        <td class="border border-gray-300 px-4 py-2 font-medium">${totalHoras}</td>
                        <td class="border border-gray-300 px-4 py-2">${registro.observacoes || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2 no-print">
                            <button class="btn-primary text-sm mr-1 editar-btn" data-id="${registro.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-primary bg-red-500 hover:bg-red-600 text-sm excluir-btn" data-id="${registro.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    elementos.registrosTabela.appendChild(tr);
                });
                
                // Adicionar event listeners para os bot√µes
                document.querySelectorAll('.editar-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.dataset.id;
                        stateManager.editarRegistro(id);
                    });
                });
                
                document.querySelectorAll('.excluir-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.dataset.id;
                        stateManager.excluirRegistro(id);
                    });
                });
            },
            
            // Atualizar resumo
            atualizarResumo: () => {
                const periodoAtual = stateManager.obterPeriodoAtual();
                const registrosPeriodo = state.registros.filter(registro => {
                    const dataRegistro = new Date(registro.data);
                    return dataRegistro >= periodoAtual.inicio && dataRegistro <= periodoAtual.fim;
                });
                
                // Calcular totais
                let totalMinutos = 0;
                
                registrosPeriodo.forEach(registro => {
                    totalMinutos += utils.calcularHorasDia(registro);
                });
                
                // Calcular sal√°rio
                let salario = 0;
                
                if (state.modoTrabalho === 'horista') {
                    // Horista: valor por hora * total de horas
                    salario = (totalMinutos / 60) * state.valorHoraAula;
                } else {
                    // Mensalista: sal√°rio fixo + compensa√ß√£o de horas extras
                    const cargaHorariaMensal = parseFloat(elementos.cargaHorariaMensal.value) || 160;
                    const salarioMensal = parseFloat(elementos.salarioMensal.value) || 3000;
                    const valorHora = salarioMensal / cargaHorariaMensal;
                    
                    const horasTrabalhadas = totalMinutos / 60;
                    const diferencaHoras = horasTrabalhadas - cargaHorariaMensal;
                    
                    if (diferencaHoras > 0) {
                        // Horas extras
                        salario = salarioMensal + (diferencaHoras * valorHora * (1 + state.valorHoraExtra / 100));
                    } else if (diferencaHoras < 0) {
                        // Horas faltantes (desconto)
                        salario = salarioMensal + (diferencaHoras * valorHora);
                    } else {
                        salario = salarioMensal;
                    }
                }
                
                // Aplicar descontos
                state.descontos.forEach(desconto => {
                    salario -= desconto.valor;
                });
                
                // Atualizar elementos
                elementos.resumoHorasTrabalhadas.textContent = utils.minutosParaHoras(totalMinutos);
                elementos.resumoSalarioBruto.textContent = utils.formatarMoeda(Math.max(0, salario));
                
                // Atualizar informa√ß√µes de sal√°rio
                elementos.infoTotalHoras.textContent = utils.minutosParaHoras(totalMinutos);
                elementos.infoValorHora.textContent = utils.formatarMoeda(state.valorHoraAula);
                elementos.infoSalarioBruto.textContent = utils.formatarMoeda(Math.max(0, salario));
                
                // Calcular horas extras
                let totalMinutosExtras = 0;
                registrosPeriodo.forEach(registro => {
                    const minutosDia = utils.calcularHorasDia(registro);
                    if (minutosDia > 8 * 60) {
                        totalMinutosExtras += minutosDia - (8 * 60);
                    }
                });
                
                elementos.infoHorasExtras.textContent = utils.minutosParaHoras(totalMinutosExtras);
                
                // Atualizar gr√°ficos
                stateManager.atualizarGraficos(registrosPeriodo);
            },
            
            // Atualizar gr√°ficos
            atualizarGraficos: (registrosPeriodo) => {
                // Preparar dados para o gr√°fico de horas por dia
                const datas = [];
                const horas = [];
                
                registrosPeriodo.forEach(registro => {
                    datas.push(utils.formatarData(registro.data));
                    horas.push(utils.calcularHorasDia(registro) / 60); // Converter para horas
                });
                
                // Gr√°fico de horas por dia
                const horasCtx = document.getElementById('horasChart').getContext('2d');
                
                // Destruir gr√°fico anterior se existir
                if (window.horasChart) {
                    window.horasChart.destroy();
                }
                
                window.horasChart = new Chart(horasCtx, {
                    type: 'bar',
                    data: {
                        labels: datas,
                        datasets: [{
                            label: 'Horas Trabalhadas',
                            data: horas,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Horas'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        }
                    }
                });
                
                // Gr√°fico de distribui√ß√£o
                const distribuicaoCtx = document.getElementById('distribuicaoChart').getContext('2d');
                
                // Calcular distribui√ß√£o
                let horasNormais = 0;
                let horasExtras = 0;
                
                registrosPeriodo.forEach(registro => {
                    const minutosDia = utils.calcularHorasDia(registro);
                    if (minutosDia <= 8 * 60) {
                        horasNormais += minutosDia / 60;
                    } else {
                        horasNormais += 8;
                        horasExtras += (minutosDia / 60) - 8;
                    }
                });
                
                // Destruir gr√°fico anterior se existir
                if (window.distribuicaoChart) {
                    window.distribuicaoChart.destroy();
                }
                
                window.distribuicaoChart = new Chart(distribuicaoCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Horas Normais', 'Horas Extras'],
                        datasets: [{
                            data: [horasNormais, horasExtras],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(239, 68, 68, 0.7)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },
            
            // Atualizar UI de descontos
            atualizarDescontosUI: () => {
                elementos.descontosContainer.innerHTML = '';
                
                state.descontos.forEach((desconto, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center mb-2';
                    div.innerHTML = `
                        <input type="text" class="modern-input flex-1 mr-2" value="${desconto.descricao}" 
                               placeholder="Descri√ß√£o do desconto" data-index="${index}">
                        <input type="number" class="modern-input w-24 mr-2" step="0.01" min="0" 
                               value="${desconto.valor}" placeholder="Valor" data-index="${index}">
                        <button class="btn-primary bg-red-500 hover:bg-red-600 remover-desconto" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    elementos.descontosContainer.appendChild(div);
                });
                
                // Adicionar event listeners para os inputs de desconto
                document.querySelectorAll('.descontosContainer input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        if (e.target.type === 'text') {
                            state.descontos[index].descricao = e.target.value;
                        } else {
                            state.descontos[index].valor = parseFloat(e.target.value) || 0;
                        }
                        stateManager.salvarEstado();
                        stateManager.atualizarResumo();
                    });
                });
                
                // Adicionar event listeners para os bot√µes de remover
                document.querySelectorAll('.remover-desconto').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.remover-desconto').dataset.index);
                        state.descontos.splice(index, 1);
                        stateManager.salvarEstado();
                        stateManager.atualizarUI();
                    });
                });
            },
            
            // Calcular valores para mensalista
            calcularMensalista: () => {
                const periodoAtual = stateManager.obterPeriodoAtual();
                const registrosPeriodo = state.registros.filter(registro => {
                    const dataRegistro = new Date(registro.data);
                    return dataRegistro >= periodoAtual.inicio && dataRegistro <= periodoAtual.fim;
                });
                
                // Calcular total de horas trabalhadas
                let totalMinutos = 0;
                registrosPeriodo.forEach(registro => {
                    totalMinutos += utils.calcularHorasDia(registro);
                });
                
                const horasTrabalhadas = totalMinutos / 60;
                elementos.horasTrabalhadasMensal.textContent = utils.minutosParaHoras(totalMinutos);
                
                // Calcular horas a compensar/pagar
                const cargaHorariaMensal = parseFloat(elementos.cargaHorariaMensal.value) || 160;
                const salarioMensal = parseFloat(elementos.salarioMensal.value) || 3000;
                const valorHora = salarioMensal / cargaHorariaMensal;
                
                const diferencaHoras = horasTrabalhadas - cargaHorariaMensal;
                elementos.horasCompensar.textContent = utils.minutosParaHoras(Math.abs(diferencaHoras) * 60);
                
                // Calcular valor a compensar/pagar
                let valorCompensar = 0;
                if (diferencaHoras > 0) {
                    // Horas extras
                    valorCompensar = diferencaHoras * valorHora * (1 + state.valorHoraExtra / 100);
                } else if (diferencaHoras < 0) {
                    // Horas faltantes
                    valorCompensar = diferencaHoras * valorHora;
                }
                
                elementos.valorCompensar.textContent = utils.formatarMoeda(valorCompensar);
            },
            
            // Obter per√≠odo atual de c√°lculo
            obterPeriodoAtual: () => {
                const hoje = new Date();
                const ano = hoje.getFullYear();
                const mes = hoje.getMonth();
                
                let inicio, fim;
                
                if (state.periodoCalculo.tipo === 'standard') {
                    // Per√≠odo padr√£o: 16 do m√™s atual a 15 do pr√≥ximo m√™s
                    inicio = new Date(ano, mes, 16);
                    fim = new Date(ano, mes + 1, 15);
                } else {
                    // Per√≠odo personalizado
                    inicio = new Date(ano, mes, state.periodoCalculo.diaInicio);
                    fim = new Date(ano, mes + 1, state.periodoCalculo.diaFim);
                }
                
                // Ajustar se hoje estiver antes do in√≠cio do per√≠odo
                if (hoje < inicio) {
                    inicio = new Date(ano, mes - 1, state.periodoCalculo.diaInicio);
                    fim = new Date(ano, mes, state.periodoCalculo.diaFim);
                }
                
                return { inicio, fim };
            },
            
            // Adicionar registro
            adicionarRegistro: (dados) => {
                const novoRegistro = {
                    id: utils.gerarId(),
                    data: dados.data,
                    entrada: dados.entrada,
                    saida: dados.saida,
                    intervaloSaida: dados.intervaloSaida,
                    intervaloRetorno: dados.intervaloRetorno,
                    horariosAdicionais: dados.horariosAdicionais || [],
                    observacoes: dados.observacoes
                };
                
                state.registros.push(novoRegistro);
                stateManager.salvarEstado();
                stateManager.atualizarUI();
                
                utils.mostrarToast('Registro adicionado com sucesso!');
            },
            
            // Editar registro
            editarRegistro: (id) => {
                const registro = state.registros.find(r => r.id === id);
                if (!registro) return;
                
                // Preencher formul√°rio de edi√ß√£o
                elementos.editarId.value = registro.id;
                elementos.editarData.value = registro.data;
                elementos.editarEntrada.value = registro.entrada || '';
                elementos.editarSaida.value = registro.saida || '';
                elementos.editarIntervaloSaida.value = registro.intervaloSaida || '';
                elementos.editarIntervaloRetorno.value = registro.intervaloRetorno || '';
                elementos.editarObservacoes.value = registro.observacoes || '';
                
                // Mostrar modal
                elementos.editarModal.classList.remove('hidden');
            },
            
            // Salvar edi√ß√£o de registro
            salvarEdicaoRegistro: (dados) => {
                const index = state.registros.findIndex(r => r.id === dados.id);
                if (index === -1) return;
                
                state.registros[index] = {
                    ...state.registros[index],
                    data: dados.data,
                    entrada: dados.entrada,
                    saida: dados.saida,
                    intervaloSaida: dados.intervaloSaida,
                    intervaloRetorno: dados.intervaloRetorno,
                    observacoes: dados.observacoes
                };
                
                stateManager.salvarEstado();
                stateManager.atualizarUI();
                
                utils.mostrarToast('Registro atualizado com sucesso!');
            },
            
            // Excluir registro
            excluirRegistro: (id) => {
                if (!confirm('Tem certeza que deseja excluir este registro?')) {
                    return;
                }
                
                state.registros = state.registros.filter(r => r.id !== id);
                stateManager.salvarEstado();
                stateManager.atualizarUI();
                
                utils.mostrarToast('Registro exclu√≠do com sucesso!');
            }
        };

        // Fun√ß√µes de autentica√ß√£o
        const auth = {
            // Fazer login
            login: async (usuario, senha) => {
                // Verificar se √© admin
                if (usuario === 'admin' && senha === 'admin123') {
                    state.usuarioAtual = { usuario: 'admin' };
                    state.admin = true;
                    auth.mostrarTelaAdmin();
                    utils.mostrarToast('Login admin realizado com sucesso!');
                    return true;
                }
                
                // Verificar usu√°rios normais
                const usuarioEncontrado = state.usuarios.find(u => u.usuario === usuario && u.senha === senha);
                
                if (usuarioEncontrado) {
                    state.usuarioAtual = usuarioEncontrado;
                    state.admin = false;
                    auth.mostrarTelaApp();
                    utils.mostrarToast(`Bem-vindo, ${usuario}!`);
                    return true;
                }
                
                return false;
            },
            
            // Registrar novo usu√°rio
            registrar: (usuario, senha) => {
                // Verificar se usu√°rio j√° existe
                if (state.usuarios.find(u => u.usuario === usuario)) {
                    return { sucesso: false, mensagem: 'Usu√°rio j√° existe!' };
                }
                
                // Adicionar novo usu√°rio
                const novoUsuario = {
                    usuario,
                    senha,
                    dataCriacao: new Date().toISOString()
                };
                
                state.usuarios.push(novoUsuario);
                stateManager.salvarEstado();
                
                return { sucesso: true, mensagem: 'Usu√°rio criado com sucesso!' };
            },
            
            // Mostrar tela do app
            mostrarTelaApp: () => {
                elementos.loginScreen.classList.add('hidden');
                elementos.adminScreen.classList.add('hidden');
                elementos.appScreen.classList.remove('hidden');
                
                elementos.userWelcome.textContent = state.usuarioAtual.usuario;
                
                // Carregar dados
                stateManager.carregarEstado();
            },
            
            // Mostrar tela de admin
            mostrarTelaAdmin: () => {
                elementos.loginScreen.classList.add('hidden');
                elementos.appScreen.classList.add('hidden');
                elementos.adminScreen.classList.remove('hidden');
                
                // Carregar lista de usu√°rios
                auth.carregarListaUsuarios();
            },
            
            // Mostrar tela de login
            mostrarTelaLogin: () => {
                elementos.appScreen.classList.add('hidden');
                elementos.adminScreen.classList.add('hidden');
                elementos.loginScreen.classList.remove('hidden');
                
                // Limpar formul√°rios
                elementos.loginForm.reset();
                elementos.registerForm.reset();
                elementos.loginForm.classList.remove('hidden');
                elementos.registerForm.classList.add('hidden');
                
                state.usuarioAtual = null;
                state.admin = false;
            },
            
            // Carregar lista de usu√°rios (admin)
            carregarListaUsuarios: () => {
                elementos.usersList.innerHTML = '';
                
                if (state.usuarios.length === 0) {
                    elementos.usersList.innerHTML = `
                        <tr>
                            <td colspan="2" class="border border-gray-300 px-4 py-2 text-center text-gray-500">
                                Nenhum usu√°rio cadastrado.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                state.usuarios.forEach(usuario => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2">${usuario.usuario}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <button class="btn-primary bg-red-500 hover:bg-red-600 text-sm excluir-usuario" data-user="${usuario.usuario}">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </td>
                    `;
                    
                    elementos.usersList.appendChild(tr);
                });
                
                // Adicionar event listeners para os bot√µes de excluir
                document.querySelectorAll('.excluir-usuario').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const usuario = e.target.closest('.excluir-usuario').dataset.user;
                        auth.excluirUsuario(usuario);
                    });
                });
            },
            
            // Excluir usu√°rio (admin)
            excluirUsuario: (usuario) => {
                if (!confirm(`Tem certeza que deseja excluir o usu√°rio "${usuario}"?`)) {
                    return;
                }
                
                state.usuarios = state.usuarios.filter(u => u.usuario !== usuario);
                stateManager.salvarEstado();
                auth.carregarListaUsuarios();
                
                utils.mostrarToast(`Usu√°rio "${usuario}" exclu√≠do com sucesso!`);
            },
            
            // Alterar senha do admin
            alterarSenhaAdmin: (senhaAtual, novaSenha, confirmacao) => {
                // Verificar senha atual
                if (senhaAtual !== 'admin123') {
                    return { sucesso: false, mensagem: 'Senha atual incorreta!' };
                }
                
                // Verificar se as novas senhas coincidem
                if (novaSenha !== confirmacao) {
                    return { sucesso: false, mensagem: 'As novas senhas n√£o coincidem!' };
                }
                
                // Em uma aplica√ß√£o real, aqui salvar√≠amos a nova senha
                // Por simplicidade, vamos apenas mostrar uma mensagem
                return { 
                    sucesso: true, 
                    mensagem: 'Senha alterada com sucesso! (Em uma aplica√ß√£o real, a senha seria salva)' 
                };
            },
            
            // Criar novo usu√°rio (admin)
            criarUsuario: (usuario, senha, confirmacao) => {
                // Verificar se usu√°rio j√° existe
                if (state.usuarios.find(u => u.usuario === usuario)) {
                    return { sucesso: false, mensagem: 'Usu√°rio j√° existe!' };
                }
                
                // Verificar se as senhas coincidem
                if (senha !== confirmacao) {
                    return { sucesso: false, mensagem: 'As senhas n√£o coincidem!' };
                }
                
                // Adicionar novo usu√°rio
                const novoUsuario = {
                    usuario,
                    senha,
                    dataCriacao: new Date().toISOString()
                };
                
                state.usuarios.push(novoUsuario);
                stateManager.salvarEstado();
                
                return { sucesso: true, mensagem: 'Usu√°rio criado com sucesso!' };
            }
        };

        // Inicializa√ß√£o da aplica√ß√£o
        const init = () => {
            // Configurar data atual no formul√°rio
            elementos.data.value = utils.dataAtual();
            
            // Configurar event listeners
            
            // Login/Registro
            elementos.loginBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                
                const usuario = elementos.loginUsername.value.trim();
                const senha = elementos.loginPassword.value;
                
                if (!usuario || !senha) {
                    utils.mostrarToast('Preencha todos os campos!', 'error');
                    return;
                }
                
                elementos.loginText.textContent = 'Entrando...';
                elementos.loginLoading.classList.remove('hidden');
                
                // Simular delay de rede
                setTimeout(async () => {
                    const sucesso = await auth.login(usuario, senha);
                    
                    elementos.loginText.textContent = 'Entrar';
                    elementos.loginLoading.classList.add('hidden');
                    
                    if (!sucesso) {
                        utils.mostrarToast('Usu√°rio ou senha incorretos!', 'error');
                    }
                }, 1000);
            });
            
            elementos.registerBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                
                const usuario = elementos.registerUsername.value.trim();
                const senha = elementos.registerPassword.value;
                const confirmacao = elementos.confirmPassword.value;
                
                if (!usuario || !senha || !confirmacao) {
                    utils.mostrarToast('Preencha todos os campos!', 'error');
                    return;
                }
                
                if (senha !== confirmacao) {
                    utils.mostrarToast('As senhas n√£o coincidem!', 'error');
                    return;
                }
                
                elementos.registerText.textContent = 'Cadastrando...';
                elementos.registerLoading.classList.remove('hidden');
                
                // Simular delay de rede
                setTimeout(() => {
                    const resultado = auth.registrar(usuario, senha);
                    
                    elementos.registerText.textContent = 'Cadastrar';
                    elementos.registerLoading.classList.add('hidden');
                    
                    if (resultado.sucesso) {
                        utils.mostrarToast(resultado.mensagem);
                        elementos.showLogin.click();
                    } else {
                        utils.mostrarToast(resultado.mensagem, 'error');
                    }
                }, 1000);
            });
            
            elementos.showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                elementos.loginForm.classList.add('hidden');
                elementos.registerForm.classList.remove('hidden');
            });
            
            elementos.showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                elementos.registerForm.classList.add('hidden');
                elementos.loginForm.classList.remove('hidden');
            });
            
            // Logout
            elementos.logoutBtn.addEventListener('click', () => {
                auth.mostrarTelaLogin();
            });
            
            elementos.adminLogoutBtn.addEventListener('click', () => {
                auth.mostrarTelaLogin();
            });
            
            // Modo escuro
            elementos.darkModeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    elementos.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i> Modo Claro';
                } else {
                    elementos.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i> Modo Escuro';
                }
            });
            
            // Exportar/Importar
            elementos.exportBtn.addEventListener('click', () => {
                const dados = {
                    registros: state.registros,
                    configuracoes: {
                        modoTrabalho: state.modoTrabalho,
                        periodoCalculo: state.periodoCalculo,
                        valorHoraAula: state.valorHoraAula,
                        valorHoraExtra: state.valorHoraExtra,
                        descontos: state.descontos
                    }
                };
                
                const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `controle-ponto-${utils.dataAtual()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                utils.mostrarToast('Dados exportados com sucesso!');
            });
            
            elementos.importBtn.addEventListener('click', () => {
                elementos.importFile.click();
            });
            
            elementos.importFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const dados = JSON.parse(event.target.result);
                        
                        if (dados.registros) {
                            state.registros = dados.registros;
                        }
                        
                        if (dados.configuracoes) {
                            state.modoTrabalho = dados.configuracoes.modoTrabalho || state.modoTrabalho;
                            state.periodoCalculo = dados.configuracoes.periodoCalculo || state.periodoCalculo;
                            state.valorHoraAula = dados.configuracoes.valorHoraAula || state.valorHoraAula;
                            state.valorHoraExtra = dados.configuracoes.valorHoraExtra || state.valorHoraExtra;
                            state.descontos = dados.configuracoes.descontos || state.descontos;
                        }
                        
                        stateManager.salvarEstado();
                        stateManager.atualizarUI();
                        
                        utils.mostrarToast('Dados importados com sucesso!');
                    } catch (error) {
                        console.error('Erro ao importar dados:', error);
                        utils.mostrarToast('Erro ao importar dados. Verifique o arquivo.', 'error');
                    }
                };
                reader.readAsText(file);
                
                // Limpar input
                elementos.importFile.value = '';
            });
            
            // Modo de trabalho
            document.querySelectorAll('.modern-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.modoTrabalho = tab.dataset.mode;
                    stateManager.atualizarModoTrabalhoUI();
                    stateManager.salvarEstado();
                });
            });
            
            // Configura√ß√µes de mensalista
            elementos.cargaHorariaMensal.addEventListener('change', () => {
                stateManager.calcularMensalista();
            });
            
            elementos.salarioMensal.addEventListener('change', () => {
                stateManager.calcularMensalista();
            });
            
            // Per√≠odo de c√°lculo
            elementos.periodTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    state.periodoCalculo.tipo = radio.value;
                    stateManager.atualizarPeriodoCalculoUI();
                    stateManager.salvarEstado();
                });
            });
            
            elementos.periodStartDay.addEventListener('change', () => {
                state.periodoCalculo.diaInicio = parseInt(elementos.periodStartDay.value) || 16;
                state.periodoCalculo.diaFim = state.periodoCalculo.diaInicio - 1;
                if (state.periodoCalculo.diaFim < 1) {
                    state.periodoCalculo.diaFim = 31;
                }
                elementos.periodEndDay.value = state.periodoCalculo.diaFim;
                
                stateManager.atualizarPeriodoCalculoUI();
                stateManager.salvarEstado();
            });
            
            // Formul√°rio de ponto
            elementos.pontoForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const dados = {
                    data: elementos.data.value,
                    entrada: elementos.entrada.value,
                    saida: elementos.saida.value,
                    intervaloSaida: elementos.intervaloSaida.value,
                    intervaloRetorno: elementos.intervaloRetorno.value,
                    observacoes: elementos.observacoes.value,
                    horariosAdicionais: []
                };
                
                // Coletar hor√°rios adicionais
                document.querySelectorAll('.horario-adicional').forEach(horario => {
                    const entrada = horario.querySelector('.entrada-adicional').value;
                    const saida = horario.querySelector('.saida-adicional').value;
                    
                    if (entrada && saida) {
                        dados.horariosAdicionais.push({ entrada, saida });
                    }
                });
                
                stateManager.adicionarRegistro(dados);
                elementos.pontoForm.reset();
                elementos.data.value = utils.dataAtual();
                elementos.horariosAdicionais.innerHTML = '';
            });
            
            elementos.limparForm.addEventListener('click', () => {
                elementos.pontoForm.reset();
                elementos.data.value = utils.dataAtual();
                elementos.horariosAdicionais.innerHTML = '';
            });
            
            elementos.adicionarHorario.addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'horario-adicional flex items-center gap-2';
                div.innerHTML = `
                    <input type="time" class="entrada-adicional modern-input flex-1">
                    <span>√†s</span>
                    <input type="time" class="saida-adicional modern-input flex-1">
                    <button type="button" class="btn-primary bg-red-500 hover:bg-red-600 remover-horario">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                elementos.horariosAdicionais.appendChild(div);
                
                // Adicionar event listener para o bot√£o de remover
                div.querySelector('.remover-horario').addEventListener('click', () => {
                    div.remove();
                });
            });
            
            // Configura√ß√µes de sal√°rio
            elementos.valorHoraAula.addEventListener('change', () => {
                state.valorHoraAula = parseFloat(elementos.valorHoraAula.value) || 50.00;
                stateManager.salvarEstado();
                stateManager.atualizarResumo();
            });
            
            elementos.valorHoraExtra.addEventListener('change', () => {
                state.valorHoraExtra = parseFloat(elementos.valorHoraExtra.value) || 50;
                stateManager.salvarEstado();
                stateManager.atualizarResumo();
            });
            
            elementos.adicionarDesconto.addEventListener('click', () => {
                state.descontos.push({
                    id: utils.gerarId(),
                    descricao: '',
                    valor: 0
                });
                
                stateManager.salvarEstado();
                stateManager.atualizarDescontosUI();
            });
            
            elementos.calcularSalario.addEventListener('click', () => {
                stateManager.atualizarResumo();
                utils.mostrarToast('Sal√°rio calculado com sucesso!');
            });
            
            // A√ß√µes de relat√≥rio
            elementos.imprimirRelatorio.addEventListener('click', () => {
                window.print();
            });
            
            elementos.exportarDados.addEventListener('click', () => {
                elementos.exportBtn.click();
            });
            
            // Filtros
            elementos.filtrarRegistros.addEventListener('click', () => {
                // Implementar filtros (simplificado)
                const mes = prompt('Digite o m√™s (1-12) para filtrar:');
                if (mes) {
                    const mesNum = parseInt(mes);
                    if (mesNum >= 1 && mesNum <= 12) {
                        const registrosFiltrados = state.registros.filter(registro => {
                            const data = new Date(registro.data);
                            return data.getMonth() + 1 === mesNum;
                        });
                        
                        // Temporariamente substituir registros para exibir apenas os filtrados
                        const registrosOriginais = state.registros;
                        state.registros = registrosFiltrados;
                        stateManager.atualizarTabelaRegistros();
                        state.registros = registrosOriginais;
                        
                        utils.mostrarToast(`Mostrando ${registrosFiltrados.length} registros do m√™s ${mesNum}`);
                    } else {
                        utils.mostrarToast('M√™s inv√°lido!', 'error');
                    }
                }
            });
            
            elementos.limparFiltros.addEventListener('click', () => {
                stateManager.atualizarTabelaRegistros();
                utils.mostrarToast('Filtros removidos');
            });
            
            // Modal de edi√ß√£o
            elementos.editarForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const dados = {
                    id: elementos.editarId.value,
                    data: elementos.editarData.value,
                    entrada: elementos.editarEntrada.value,
                    saida: elementos.editarSaida.value,
                    intervaloSaida: elementos.editarIntervaloSaida.value,
                    intervaloRetorno: elementos.editarIntervaloRetorno.value,
                    observacoes: elementos.editarObservacoes.value
                };
                
                stateManager.salvarEdicaoRegistro(dados);
                elementos.editarModal.classList.add('hidden');
            });
            
            elementos.cancelarEdicao.addEventListener('click', () => {
                elementos.editarModal.classList.add('hidden');
            });
            
            // Admin
            elementos.changeAdminPassword.addEventListener('click', () => {
                const senhaAtual = elementos.currentPassword.value;
                const novaSenha = elementos.newPassword.value;
                const confirmacao = elementos.confirmNewPassword.value;
                
                if (!senhaAtual || !novaSenha || !confirmacao) {
                    utils.mostrarToast('Preencha todos os campos!', 'error');
                    return;
                }
                
                const resultado = auth.alterarSenhaAdmin(senhaAtual, novaSenha, confirmacao);
                
                if (resultado.sucesso) {
                    utils.mostrarToast(resultado.mensagem);
                    elementos.currentPassword.value = '';
                    elementos.newPassword.value = '';
                    elementos.confirmNewPassword.value = '';
                } else {
                    utils.mostrarToast(resultado.mensagem, 'error');
                }
            });
            
            elementos.createUserBtn.addEventListener('click', () => {
                const usuario = elementos.newUsername.value.trim();
                const senha = elementos.newUserPassword.value;
                const confirmacao = elementos.confirmNewUserPassword.value;
                
                if (!usuario || !senha || !confirmacao) {
                    utils.mostrarToast('Preencha todos os campos!', 'error');
                    return;
                }
                
                const resultado = auth.criarUsuario(usuario, senha, confirmacao);
                
                if (resultado.sucesso) {
                    utils.mostrarToast(resultado.mensagem);
                    elementos.newUsername.value = '';
                    elementos.newUserPassword.value = '';
                    elementos.confirmNewUserPassword.value = '';
                    auth.carregarListaUsuarios();
                } else {
                    utils.mostrarToast(resultado.mensagem, 'error');
                }
            });
            
            // Carregar dados iniciais
            stateManager.carregarEstado();
        };

        // Inicializar a aplica√ß√£o quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>